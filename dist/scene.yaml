#Getting the indentation right is SUPER IMPORTANT to make this work!
#styles for Tangram map
import:
    - https://www.nextzen.org/carto/refill-style/refill-style.zip
    - https://s3.amazonaws.com/xyz-demo/data/demo.yaml
    - https://www.nextzen.org/carto/refill-style/themes/label-5.zip

#The data sources uploaded earlier to HERE xyz
#Will be loaded on top of base Tangram map
sources:
    stateBorders:
        #Tiled endpoint to the data source on HERE xyz
        url: https://xyz.api.here.com/hub/spaces/SoJrBH8I/tile/web/{z}_{x}_{y}
        url_params:
            access_token: ANOkxlf9QMWB72jUxUuT7AA
            clip: true
        type: GeoJSON
    districtBorders:
        #Tiled endpoint to the data source on HERE xyz
        url: https://xyz.api.here.com/hub/spaces/sYm0uuVK/tile/web/{z}_{x}_{y}
        url_params:
            access_token: ANOkxlf9QMWB72jUxUuT7AA
            clip: true
        type: GeoJSON
    publicClinicLocations:
        #Tiled endpoint to the data source on HERE xyz
        url: https://xyz.api.here.com/hub/spaces/CnsQWqCa/tile/web/{z}_{x}_{y}
        url_params:
            access_token: ANOkxlf9QMWB72jUxUuT7AA
            clip: true
        type: GeoJSON
    heatmapStatePopulation:
        #Tiled endpoint to the data source on HERE xyz
        url: https://xyz.api.here.com/hub/spaces/ccooUvui/tile/web/{z}_{x}_{y}
        url_params:
            access_token: ANOkxlf9QMWB72jUxUuT7AA
            clip: true
        type: GeoJSON
    

# Styles the polygons of the chloropleth
styles:
    _polygons_inlay:
        base: polygons
        blend: inlay
        blend_order: 1
textures:
    icons: 
        url: clinicIconResized.jpg #1 image of many icons in a long strip
        filtering: mipmap #cuts out images at specified positions
        sprites:  # define sprite's: [x origin, y origin, width, height]. Default unit is px.
            clinic: [0, 0, 32, 32]
            

layers:
    _stateBorders:
        enabled: false
        data: {source: stateBorders}
        draw:
            polygons:
                interactive: true
                order: global.sdk_order_under_water_0
            lines:
                interactive: false
                order: global.sdk_order_under_roads_0
                color: green
                width: 3px
    _districtBorders:
        enabled: false
        data: {source: districtBorders}
        draw:
            polygons:
                interactive: true
                order: global.sdk_order_under_water_0
            lines:
                interactive: false
                order: global.sdk_order_under_roads_0
                color: blue
                width: 3px
    _publicClinicLocations:
        #Eyyy, replaced with icons!
        data: {source: publicClinicLocations}
        enabled: true
        _all:
            draw:
                points:
                    collide: false #MUST to prevent nearby features from being burried!
                    placement: spaced
                    placement_spacing: [[17, 70px], [20, 175px]]
                    interactive: true #Must for popups to occur
                    texture: icons
                    sprite: clinic
                    #Stops at zoom x, 1D size px. 
                    #For square icons, 1D becomes 2D. If 6px specified, sprite has sides of 6px each  
                    #size: [[6, [auto, 10px]], [12, [auto,20px]], [20, [auto,60px]]]
                    size: [[6, 10px], [12, 20px], [20, 60px]]
    _heatmapStatePopulation:
        enabled: true
        data: {source: heatmapStatePopulation}
        draw:
            polygons:
                interactive: true
                order: global.sdk_order_under_water_0
                color: |
                    function() {
                         /* Supposed to go yellow-orange-red
                        rgba(240,228,93,1) 0%, 
                        rgba(245,245,12,1) 22%, 
                        rgba(245,167,12,1) 43%, 
                        rgba(240,125,24,1) 66%, 
                        rgba(240,47,23,1) 85%, 
                        rgba(231,56,39,1) 100%);
                        */
                        /*
                        //Original Colour gradient ranges from gray (lowest power) to red (mid power) to brown (highest power)
                        value >= 1267538 ? "rgba(127, 0, 0, 0.5)" :
                        value >= 1140784.2 ? "rgba(167, 4, 3, 0.5)" :
                        value >= 1014030.4 ? "rgba(200, 29, 19, 0.5)" :
                        value >= 887276.6 ? "rgba(224, 69, 48, 0.5)" :
                        value >= 760522.8 ? "rgba(241, 108, 73, 0.5)" :
                        value >= 633769 ? "rgba(250, 142, 93, 0.5)" :
                        value >= 507015.2 ? "rgba(253, 176, 122, 0.5)" :
                        value >= 380261.4 ? "rgba(253, 202, 148, 0.5)" :
                        value >= 253507.6 ? "rgba(253, 220, 175, 0.5)" :
                        value >= 126753.8 ? "rgba(254, 235, 207, 0.5)" :
                        */
                        var value = feature.population;
                        //Colour gradient starts with largest value then moves downwards!
                        var color = value >= 5572886 ? "rgba(231,56,39,1)" :
                                    value >= 4644071 ? "rgba(240,47,23,1)" :
                                    value >= 3715257 ? "rgba(240,125,24,1)" :
                                    value >= 2786443 ? "rgba(245,167,12,1)" :
                                    value <= 1857629 ? "rgba(240,228,93,1)" :
                                    "rgba(245,245,12,1)";
                        return color
                    }
            lines:
                #Draws underlying state borders
                interactive: true
                order: global.sdk_order_under_roads_0
                color: black
                width: 3px
    


